# **🔄 Comprendre le Workflow de Notification**

Quand un service ou un hôte change d’état, Centreon ne **notifie pas automatiquement**. Il suit un **workflow strict**, étape par étape. Pour bien débugger, il faut comprendre **ce qui se passe en interne**, et **où la chaîne peut être rompue**.



## **🧠 SOFT vs HARD : Le cœur du système**

Un état **SOFT** (provisoire, en phase de confirmation) **ne déclenche jamais de notification**.

➡️ Seul un **état HARD** (confirmé après X tentatives) **active le moteur de notification**.

Tu dois donc **vérifier le niveau du statut** avant toute autre chose.



## **⚙️ Conditions de Déclenchement**

Un certain nombre de conditions doivent être **toutes validées** pour qu’une notification parte :

- **Statut HARD** ✅
- **Notifications activées** sur l’hôte/le service ET dans le template 🧬
- **Pas de Downtime en cours** 💤
- **Période de notification OK** (ex: 9h-18h) ⏰
- **Type de statut concerné bien configuré pour être notifié** (critique, warning, recovery...) 🚨

👉 Si une seule condition est KO, **la notif ne partira pas**.



## **📦 Templates et Héritage**

Les templates sont souvent à l’origine d’un oubli :

- Une **notification désactivée dans un template** désactive la notif partout où ce template est appliqué.
- **Attention à l’héritage** : un service peut hériter d’un template qui **écrase les paramètres**.

Vérifie donc :

- **Templates de services/hôtes** ✔️
- **Inheritance dans les dépendances de configuration** 🧩



## **👤 Contacts et Commandes**

Une fois que le statut est **prêt à notifier**, Centreon :

1.  Récupère la **liste des contacts associés**
2.  Pour chaque contact, vérifie :

    - 📬 Notifications activées ?
    - ⏰ Période de notification OK ?
    - 🚦 Notif autorisée pour le type de statut actuel ?

3.  🛠️ Puis exécute la **commande de notification** associée (ex : email, SMS, etc.)

👉 Si la commande est mal configurée (mauvais binaire, mauvaise syntaxe), la notif échoue **même si tout le reste est bon**.

